<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient Login - Healora</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #e1f5fe, #b3e5fc);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      padding: 50px 35px;
      width: 100%;
      max-width: 420px;
      text-align: center;
    }

    .logo {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 25px;
    }

    .logo img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      border-radius: 50%;
      background-color: #f1f1f1;
      padding: 10px;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
    }

    h2 {
      font-weight: 600;
      color: #0288d1;
      margin-bottom: 25px;
    }

    .btn-custom {
      background-color: #0288d1;
      color: white;
      font-weight: 500;
      transition: 0.3s;
    }

    .btn-custom:hover {
      background-color: #0277bd;
    }

    .text-center a {
      color: #0288d1;
      text-decoration: none;
      font-weight: 500;
      margin: 0 4px;
    }

    .text-center a:hover {
      text-decoration: underline;
    }

    .message {
      font-size: 0.9rem;
      margin-bottom: 10px;
      color: red;
      text-align: center;
    }
    .success {
      color: green;
    }
    /* Error input styling */
    .error {
      border-color: #dc3545 !important;
      box-shadow: 0 0 0 2px rgba(220,53,69,0.1);
    }
  </style>
</head>
<body>

  <div class="login-card">
    <div class="logo">
      <img src="/images/logo.jpg" alt="Healora Logo">
    </div>

    <h2>Patient Login</h2>
    <form id="patientLoginForm" autocomplete="on">
      <div id="serverError" class="text-danger mb-2"></div>
      <div id="successMessage" class="text-success mb-2"></div>

      <input type="email" name="email" id="email" placeholder="Email" class="form-control mb-1" autocomplete="username">
      <div id="errorEmail" class="text-danger mb-2"></div>

      <div class="position-relative mb-1">
        <input type="password" name="password" id="password" placeholder="Password" class="form-control" autocomplete="current-password">
        <i class="fa-solid fa-eye toggle-password" id="togglePassword"
           style="position:absolute; right:15px; top:12px; cursor:pointer; color:#888;"></i>
      </div>
      <div id="errorPassword" class="text-danger mb-2"></div>

      <div class="mb-3 d-flex justify-content-between align-items-center">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="remember">
                                <label class="form-check-label" for="remember">
                                    Remember me
                                </label>
                            </div>
                            <a href="/patient/forgot-password" class="forgot-password">Forgot password?</a>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Sign In</button>

                        <div class="signup-link">
                            Don't have an account? <a href="/patient/signup">Sign up</a>
                        </div>
      </div>

      

    </form>
  

  <script>
    // Password visibility toggle
    const togglePassword = document.getElementById("togglePassword");
    const passwordInput = document.getElementById("password");
    togglePassword.addEventListener("click", () => {
      const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
      passwordInput.setAttribute("type", type);
      togglePassword.classList.toggle("fa-eye-slash");
    });
  </script>

  <script>
    // AJAX login form handler
    const form = document.getElementById("patientLoginForm");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Clear previous errors
      ["Email","Password"].forEach(f => {
        document.getElementById("error" + f).textContent = "";
        document.getElementById(f.toLowerCase()).classList.remove("error");
      });
      document.getElementById("serverError").textContent = "";
      document.getElementById("successMessage").textContent = "";

      const dataToSend = {
        email: document.getElementById("email").value.trim(),
        password: document.getElementById("password").value.trim()
      };

      try {
        const res = await fetch("/patient/login", {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(dataToSend)
        });
        const result = await res.json();

        if(res.ok){
          // Show success, redirect to dashboard
          document.getElementById("successMessage").textContent = "Login successful! Redirecting...";
          setTimeout(() => {
            window.location.href = result.redirect;
          }, 1200);
        } else {
          const errs = result.errors || {};
          if(errs.email) {
            document.getElementById("errorEmail").textContent = errs.email;
            document.getElementById("email").classList.add("error");
          }
          if(errs.password) {
            document.getElementById("errorPassword").textContent = errs.password;
            document.getElementById("password").classList.add("error");
          }
          if(errs.general) document.getElementById("serverError").textContent = errs.general;
        }
      } catch(err){
        document.getElementById("serverError").textContent = "Server error. Please try again later.";
      }
    });
  </script>

  <!-- FontAwesome, if you use icons -->
  <script src="https://kit.fontawesome.com/your-kit-id.js" crossorigin="anonymous"></script>

</body>
</html>
