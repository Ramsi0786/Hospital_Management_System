<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title><%= title %></title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <link rel="stylesheet" href="/css/patient/dashboard.css">
</head>
<body>

  <div class="sidebar">
    <div class="logo">
      <span>Healora</span>
    </div>

    <ul class="nav-menu">
      <li class="nav-item">
        <a href="/patient/dashboard" class="nav-link active">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="/patient/profile" class="nav-link">
          <i class="fas fa-user"></i>
          <span>Profile</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="/patient/appointments" class="nav-link">
          <i class="fas fa-calendar-check"></i>
          <span>Appointments</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="/patient/doctors" class="nav-link">
          <i class="fas fa-user-doctor"></i>
          <span>Doctors</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="/patient/invoices" class="nav-link">
          <i class="fas fa-file-invoice"></i>
          <span>Invoices</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="/patient/settings" class="nav-link">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" onclick="showLogoutModal(); return false;">
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </a>
      </li>
    </ul>
  </div>

  <div class="main-content">
    <div class="top-bar">
      <h1 class="page-title"><%= user.name.split(' ')[0] %>'s Dashboard</h1>
      <button class="user-profile-btn">
        <div class="user-avatar-small"><%= user.name.charAt(0).toUpperCase() %></div>
        <span class="user-name">Hello <%= user.name.split(' ')[0] %></span>
      </button>
    </div>

    <% if (showPasswordSetupBanner) { %>
      <div class="alert alert-info" style="margin: 20px; background: #e3f2fd; border-left: 4px solid #2196f3;">
        <i class="fas fa-info-circle"></i>
        You signed up with Google. 
        <a href="/patient/setup-password" style="color: #1976d2; font-weight: 600;">Set up a password</a> 
        for email login.
      </div>
      <% } %>

    <div class="content-grid">

      <div class="profile-card">
  <div class="profile-header">
    <div class="profile-avatar">
      <%= user.name.split(' ')[0].substring(0,2).toUpperCase() %>
    </div>
    <div class="profile-info">
      <h2>
        <% const firstName = user.name ? user.name.split(' ')[0] : 'User'; %>
        <% if (user.gender === 'Female') { %>
           Ms <%= firstName %>
        <% } else if(user.gender === 'Male'){ %>
           Mr <%= firstName %>
        <% } else { %>
          <%= firstName %>
        <% } %>

      </h2>
      <p class="profile-subtitle">
        <%= user.gender || '-' %>
      </p>
      <p class="profile-email"><%= user.email %></p>
    </div>
  </div>

  <div class="profile-details">
    <div class="detail-box">
      <div class="detail-label">Date of Birth</div>
      <div class="detail-value">
        <%= user.dob ? new Date(user.dob).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '-' %>
      </div>
    </div>
    <div class="detail-box">
      <div class="detail-label">Phone</div>
      <div class="detail-value"><%= user.phone || '-' %></div>
    </div>
    <div class="detail-box">
      <div class="detail-label">Member Since</div>
      <div class="detail-value">
        <%= new Date(user.createdAt).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) %>
      </div>
    </div>
    <div class="detail-box">
      <div class="detail-label">Member ID</div>
      <div class="detail-value"><%= String(user._id).substring(0, 8).toUpperCase() %></div>
    </div>
  </div>
</div>

      <div class="medications-card">
        <h3>Medications</h3>
        <div id="medicationsList">
          <div class="empty-state">
            <i class="fas fa-pills"></i>
            <p>No medications prescribed</p>
          </div>
        </div>
      </div>
    </div>

    <div class="content-grid">
      <div class="wallet-card">
        <div class="wallet-header">
          <div class="wallet-title">
            <i class="fas fa-wallet"></i>
            <span>My Wallet</span>
          </div>
          <button class="add-money-btn">Add Money</button>
        </div>

        <div class="balance-display">
          <div class="balance-label">Balance</div>
          <div class="balance-amount">â‚¹ 0</div>
        </div>

        <div class="payment-methods">
          <div class="payment-icon">VISA</div>
          <div class="payment-icon">MC</div>
          <div class="payment-icon">UPI</div>
        </div>

        <div class="transaction-link">
          <a href="/patient/transactions">Show transaction history</a>
        </div>
      </div>

      <div class="consultation-card">
        <h3>Consultation History</h3>
        <div id="consultationList">
          <div class="empty-state" style="color: #a0aec0;">
            <i class="fas fa-history"></i>
            <p>No consultation history</p>
          </div>
        </div>
        <div class="view-more">
          <a href="/patient/consultations">View more</a>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="logoutModal">
    <div class="modal-content-custom">
      <div class="modal-icon">
        <i class="fas fa-sign-out-alt"></i>
      </div>
      <h3>Confirm Logout</h3>
      <p>Are you sure you want to logout from your account?</p>
      <div class="modal-buttons">
        <button class="modal-btn cancel" onclick="closeLogoutModal()">Cancel</button>
        <button class="modal-btn confirm" onclick="confirmLogout()">Logout</button>
      </div>
    </div>
  </div>

  <script>
    function showLogoutModal() {
      document.getElementById('logoutModal').classList.add('show');
    }

    function closeLogoutModal() {
      document.getElementById('logoutModal').classList.remove('show');
    }

    function confirmLogout() {
      fetch('/patient/logout', { method: 'POST' })
        .then(() => window.location.href = '/patient/login')
        .catch(() => window.location.href = '/patient/login');
    }

    document.getElementById('logoutModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeLogoutModal();
      }
    });
  </script>
</body>
</html>